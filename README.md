# Phystech Netstatus Zabbix Bot

–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ Zabbix —á–µ—Ä–µ–∑ Telegram.

## üìñ –û–ø–∏—Å–∞–Ω–∏–µ

–ë–æ—Ç –∏–Ω—Ç–µ–≥—Ä–∏—Ä—É–µ—Ç—Å—è —Å Zabbix API –∏ –ø–æ–∑–≤–æ–ª—è–µ—Ç –≤ Telegram-—á–∞—Ç–∞—Ö:

* –ü–æ–ª—É—á–∞—Ç—å —Å–≤–æ–¥–∫—É –æ—Ç–∫—Ä—ã—Ç—ã—Ö –ø—Ä–æ–±–ª–µ–º `/status`
* –ü–∏–Ω–≥–æ–≤–∞—Ç—å —Ö–æ—Å—Ç—ã `/ping <host>`
* –°–ø–∏—Å–æ–∫ —Ö–æ—Å—Ç–æ–≤ —Å –¥–µ–π—Å—Ç–≤–∏—è–º–∏ `/hosts`
* –°—Ç—Ä–æ–∏—Ç—å –≥—Ä–∞—Ñ–∏–∫–∏ –º–µ—Ç—Ä–∏–∫ `/graph <itemid> [–º–∏–Ω—É—Ç]`
* –ü–æ–ª—É—á–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ—Ç Zabbix —á–µ—Ä–µ–∑ –≤–µ–±—Ö—É–∫

## üöÄ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

* **/status** ‚Äî —Å–≤–æ–¥–∫–∞ —Ç–µ–∫—É—â–∏—Ö –ø—Ä–æ–±–ª–µ–º —Å –∫–Ω–æ–ø–∫–æ–π –ø–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–µ–π
* **/ping** ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ —Ö–æ—Å—Ç–∞ (ICMP)
* **/hosts** ‚Äî –≤—ã–±–æ—Ä —Ö–æ—Å—Ç–∞ –∏ –±—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è
* **/graph** ‚Äî –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ PNG-–≥—Ä–∞—Ñ–∏–∫–∞ –º–µ—Ç—Ä–∏–∫–∏ –∑–∞ —É–∫–∞–∑–∞–Ω–Ω—ã–π –ø–µ—Ä–∏–æ–¥
* **/events** ‚Äî —Å–ø–∏—Å–æ–∫ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –æ–ø–æ–≤–µ—â–µ–Ω–∏–π
* **Webhook** ‚Äî –æ—Ç–ø—Ä–∞–≤–∫–∞ –∞–ª–µ—Ä—Ç–æ–≤ Zabbix –≤ Telegram
* –û—Ç–≤–µ—Ç—ã –Ω–∞ –∫–æ–º–∞–Ω–¥—ã —É–¥–∞–ª—è—é—Ç—Å—è –ø—Ä–∏ —Å–ª–µ–¥—É—é—â–µ–º –æ–±—Ä–∞—â–µ–Ω–∏–∏ (—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ—Å—Ç–∞—é—Ç—Å—è)

## üìã –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
Phystech-Zabbix-Bot/
‚îú‚îÄ‚îÄ .env.example   # –ü—Ä–∏–º–µ—Ä –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
‚îú‚îÄ‚îÄ docker-compose.yml
‚îú‚îÄ‚îÄ Dockerfile
‚îú‚îÄ‚îÄ requirements.txt
‚îú‚îÄ‚îÄ main.py        # –õ–æ–≥–∏–∫–∞ –±–æ—Ç–∞ –∏ FastAPI
‚îú‚îÄ‚îÄ zbx.py         # –û–±—ë—Ä—Ç–∫–∞ –¥–ª—è Zabbix API
‚îî‚îÄ‚îÄ __init__.py
```

## üõ†Ô∏è –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è

```bash
git clone https://github.com/NeoHikaru/Phystech-Zabbix-Bot.git
cd Phystech-Zabbix-Bot
```

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

@@ -48,60 +51,64 @@ cd Phystech-Zabbix-Bot
BOT_TOKEN=–≤–∞—à_—Ç–æ–∫–µ–Ω_–±–æ—Ç–∞_telegram
ADMIN_CHAT_IDS=ID_—á–∞—Ç–∞1,ID_—á–∞—Ç–∞2  # –ø–µ—Ä–µ—á–∏—Å–ª–∏—Ç–µ ID —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é
ZABBIX_URL=https://zabbix.example.com/api_jsonrpc.php
ZABBIX_USER=api_user
ZABBIX_PASS=api_password
ZABBIX_TOKEN=      # –µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ API-—Ç–æ–∫–µ–Ω
ZABBIX_VERIFY_SSL=true  # –æ—Ç–∫–ª—é—á–∏—Ç–µ –¥–ª—è —Å–∞–º–æ–ø–æ–¥–ø–∏—Å–∞–Ω–Ω—ã—Ö —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤
ZABBIX_WEB=https://zabbix.example.com
EVENTS_DB_PATH=events.db  # –ø—É—Ç—å –∫ SQLite –±–∞–∑–µ –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–æ–±—ã—Ç–∏–π
```

### 3. –ó–∞–ø—É—Å–∫ —Å Docker Compose

```bash
docker compose up -d --build
```

–ü–æ—Å–ª–µ —Å—Ç–∞—Ä—Ç–∞:

* HTTP —Å–µ—Ä–≤–µ—Ä –±–æ—Ç–∞ –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –Ω–∞ `http://localhost:8000`
* Telegram-–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —á–µ—Ä–µ–∑ long polling

## üéõÔ∏è –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∫–æ–º–∞–Ω–¥

### /status

–û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–≤–æ–¥–∫—É –ø–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É –æ—Ç–∫—Ä—ã—Ç—ã—Ö –ø—Ä–æ–±–ª–µ–º –≤ –∫–∞–∂–¥–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏. –î–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –ø–æ–ª–Ω–æ–≥–æ —Å–ø–∏—Å–∫–∞ –Ω–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É ¬´–ü–æ–∫–∞–∑–∞—Ç—å –ø—Ä–æ–±–ª–µ–º—ã¬ª –ø–æ–¥ –æ—Ç–≤–µ—Ç–æ–º –±–æ—Ç–∞.

### /ping <host>

–ü–∏–Ω–≥—É–µ–º `<host>` 4 —Ä–∞–∑–∞ –∏ –≤—ã–≤–æ–¥–∏–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç.

```text
/ping example.com
```

### /hosts

–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å–ø–∏—Å–æ–∫ —Ö–æ—Å—Ç–æ–≤ –ø–æ—Å—Ç—Ä–∞–Ω–∏—á–Ω–æ (–ø–æ 20 —à—Ç—É–∫). –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–Ω–æ–ø–∫–∏ ¬´‚¨ÖÔ∏è¬ª –∏ ¬´‚û°Ô∏è¬ª –¥–ª—è –Ω–∞–≤–∏–≥–∞—Ü–∏–∏, –∞ ¬´–û—Ç–º–µ–Ω–∞¬ª –∑–∞–∫—Ä–æ–µ—Ç —Å–ø–∏—Å–æ–∫. –ù–∞–∂–º–∏—Ç–µ –Ω–∞ –Ω—É–∂–Ω—ã–π —Ö–æ—Å—Ç, —á—Ç–æ–±—ã –≤—ã–ø–æ–ª–Ω–∏—Ç—å –ø–∏–Ω–≥ –ø–æ –µ–≥–æ IP/DNS –∏–ª–∏ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Å–≤—è–∑–∞–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã.

### /graph <itemid> \[–º–∏–Ω—É—Ç]

–°—Ç—Ä–æ–∏–º –≥—Ä–∞—Ñ–∏–∫ –º–µ—Ç—Ä–∏–∫–∏ —Å –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä–æ–º `<itemid>` –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ `[–º–∏–Ω—É—Ç]` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 60).
–î–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è –≥—Ä–∞—Ñ–∏–∫–æ–≤ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã `ZABBIX_USER` –∏ `ZABBIX_PASS`, —á—Ç–æ–±—ã –±–æ—Ç —Å–º–æ–≥
–ø–æ–ª—É—á–∏—Ç—å –≤–µ–±‚Äë—Å–µ—Å—Å–∏—é Zabbix.

```text
/graph 1810864 1440
```

### /events

–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø–æ—Å–ª–µ–¥–Ω–∏–µ 5 –æ–ø–æ–≤–µ—â–µ–Ω–∏–π, –ø–æ–ª—É—á–µ–Ω–Ω—ã—Ö –±–æ—Ç–æ–º.

## üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≤–µ–±—Ö—É–∫–∞ Zabbix

1. –í –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ Zabbix: ¬´–û–ø–æ–≤–µ—â–µ–Ω–∏—è¬ª ‚Üí ¬´–°–ø–æ—Å–æ–±—ã –æ–ø–æ–≤–µ—â–µ–Ω–∏—è¬ª ‚Üí –¥–æ–±–∞–≤—å—Ç–µ —Å–ø–æ—Å–æ–± –æ–ø–æ–≤–µ—â–µ–Ω–∏—è:

   * URL: `http://<bot-host>:8000/zabbix`
   * –ú–µ—Ç–æ–¥: POST
2. –í –¥–µ–π—Å—Ç–≤–∏—è—Ö (Actions) —É–∫–∞–∂–∏—Ç–µ –æ—Ç–ø—Ä–∞–≤–∫—É –Ω–∞ –≤–∞—à —Å–ø–æ—Å–æ–± –æ–ø–æ–≤–µ—â–µ–Ω–∏—è –∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:

   * `subject`: `{EVENT.NAME}`
   * `message`: `{EVENT.STATUS}: {TRIGGER.NAME}`

–ë–æ—Ç –±—É–¥–µ—Ç –ø—Ä–∏–Ω–∏–º–∞—Ç—å JSON –ø–æ POST –∏ –ø–µ—Ä–µ—Å—ã–ª–∞—Ç—å –≤ Telegram.

## üìä –°–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö

–í—Å–µ –ø–æ–ª—É—á–µ–Ω–Ω—ã–µ –æ–ø–æ–≤–µ—â–µ–Ω–∏—è —Ç–∞–∫–∂–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ SQLite –±–∞–∑—É `EVENTS_DB_PATH`.
–≠—Ç–∏ –¥–∞–Ω–Ω—ã–µ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–ª—è –¥–∞–ª—å–Ω–µ–π—à–µ–≥–æ –∞–Ω–∞–ª–∏–∑–∞ –∏ –æ–±—É—á–µ–Ω–∏—è –º–æ–¥–µ–ª–µ–π.

## üêû –û—Ç–ª–∞–¥–∫–∞ –∏ –ø—Ä–æ–±–ª–µ–º—ã

* –õ–æ–≥–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞:

