# Phystech Netstatus Zabbix Bot

–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ Zabbix —á–µ—Ä–µ–∑ Telegram.

## üìñ –û–ø–∏—Å–∞–Ω–∏–µ

–ë–æ—Ç –∏–Ω—Ç–µ–≥—Ä–∏—Ä—É–µ—Ç—Å—è —Å Zabbix API –∏ –ø–æ–∑–≤–æ–ª—è–µ—Ç –≤ Telegram-—á–∞—Ç–∞—Ö:

* –ü–æ–ª—É—á–∞—Ç—å —Å–≤–æ–¥–∫—É –æ—Ç–∫—Ä—ã—Ç—ã—Ö –ø—Ä–æ–±–ª–µ–º `/status`
* –ü–∏–Ω–≥–æ–≤–∞—Ç—å —Ö–æ—Å—Ç—ã `/ping <host>`
* –°—Ç—Ä–æ–∏—Ç—å –≥—Ä–∞—Ñ–∏–∫–∏ –º–µ—Ç—Ä–∏–∫ `/graph <itemid> [–º–∏–Ω—É—Ç]`
* –ü–æ–ª—É—á–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ—Ç Zabbix —á–µ—Ä–µ–∑ –≤–µ–±—Ö—É–∫

## üöÄ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

* **/status** ‚Äî —á–∏—Å–ª–æ –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø—Ä–æ–±–ª–µ–º –ø–æ —É—Ä–æ–≤–Ω—è–º —Å–µ—Ä—å–µ–∑–Ω–æ—Å—Ç–∏
* **/ping** ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ —Ö–æ—Å—Ç–∞ (ICMP)
* **/graph** ‚Äî –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ PNG-–≥—Ä–∞—Ñ–∏–∫–∞ –º–µ—Ç—Ä–∏–∫–∏ –∑–∞ —É–∫–∞–∑–∞–Ω–Ω—ã–π –ø–µ—Ä–∏–æ–¥
* **Webhook** ‚Äî –æ—Ç–ø—Ä–∞–≤–∫–∞ –∞–ª–µ—Ä—Ç–æ–≤ Zabbix –≤ Telegram

## üìã –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
netstatus-bot/
‚îú‚îÄ‚îÄ .env        # –û–±—Ä–∞–∑–µ—Ü –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
‚îú‚îÄ‚îÄ docker-compose.yml  # –°–±–æ—Ä–∫–∞ –∏ –∑–∞–ø—É—Å–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
‚îî‚îÄ‚îÄ bot/                # –ö–æ–¥ –±–æ—Ç–∞
    ‚îú‚îÄ‚îÄ Dockerfile      # –û–ø–∏—Å–∞–Ω–∏–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
    ‚îú‚îÄ‚îÄ requirements.txt# –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ Python
    ‚îú‚îÄ‚îÄ main.py         # –õ–æ–≥–∏–∫–∞ –±–æ—Ç–∞ –∏ FastAPI
    ‚îî‚îÄ‚îÄ zbx.py          # –û–±—ë—Ä—Ç–∫–∞ –¥–ª—è Zabbix API
```

## üõ†Ô∏è –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è

```bash
git clone https://github.com/youruser/netstatus-bot.git
cd netstatus-bot
```

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

–°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Ñ–∞–π–ª `.env.example` ‚ûû `.env` –∏ –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:

```dotenv
BOT_TOKEN=–≤–∞—à_—Ç–æ–∫–µ–Ω_–±–æ—Ç–∞_telegram
ADMIN_CHAT_ID=ID_—á–∞—Ç–∞_–¥–ª—è_—É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
ZABBIX_URL=https://zabbix.example.com/api_jsonrpc.php
ZABBIX_USER=api_user
ZABBIX_PASS=api_password
ZBX_TOKEN=      # –µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ API-—Ç–æ–∫–µ–Ω
ZABBIX_WEB=https://zabbix.example.com
```

### 3. –ó–∞–ø—É—Å–∫ —Å Docker Compose

```bash
docker compose up -d --build
```

–ü–æ—Å–ª–µ —Å—Ç–∞—Ä—Ç–∞:

* HTTP —Å–µ—Ä–≤–µ—Ä –±–æ—Ç–∞ –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –Ω–∞ `http://localhost:8000`
* Telegram-–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —á–µ—Ä–µ–∑ long polling

## üéõÔ∏è –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∫–æ–º–∞–Ω–¥

### /status

–í—ã–≤–æ–¥–∏—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—Ç–∫—Ä—ã—Ç—ã—Ö –ø—Ä–æ–±–ª–µ–º –ø–æ —Å—Ç–µ–ø–µ–Ω—è–º —Å–µ—Ä—å—ë–∑–Ω–æ—Å—Ç–∏.

### /ping <host>

–ü–∏–Ω–≥—É–µ–º `<host>` 4 —Ä–∞–∑–∞ –∏ –≤—ã–≤–æ–¥–∏–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç.

```text
/ping example.com
```

### /graph <itemid> \[–º–∏–Ω—É—Ç]

–°—Ç—Ä–æ–∏–º –≥—Ä–∞—Ñ–∏–∫ –º–µ—Ç—Ä–∏–∫–∏ —Å –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä–æ–º `<itemid>` –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ `[–º–∏–Ω—É—Ç]` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 60).

```text
/graph 1810864 1440
```

## üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≤–µ–±—Ö—É–∫–∞ Zabbix

1. –í –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ Zabbix: ¬´–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ¬ª ‚Üí ¬´–ú–µ–¥–∏–∞-—Ç–∏–ø—ã¬ª ‚Üí –¥–æ–±–∞–≤—å—Ç–µ HTTP Media Type:

   * URL: `http://<bot-host>:8000/zabbix`
   * –ú–µ—Ç–æ–¥: POST
2. –í –¥–µ–π—Å—Ç–≤–∏—è—Ö (Actions) —É–∫–∞–∂–∏—Ç–µ –æ—Ç–ø—Ä–∞–≤–∫—É –Ω–∞ –≤–∞—à Media Type –∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:

   * `subject`: `{EVENT.NAME}`
   * `message`: `{EVENT.STATUS}: {TRIGGER.NAME}`

–ë–æ—Ç –±—É–¥–µ—Ç –ø—Ä–∏–Ω–∏–º–∞—Ç—å JSON –ø–æ POST –∏ –ø–µ—Ä–µ—Å—ã–ª–∞—Ç—å –≤ Telegram.

## üêû –û—Ç–ª–∞–¥–∫–∞ –∏ –ø—Ä–æ–±–ª–µ–º—ã

* –õ–æ–≥–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞:

  ```bash
  docker compose logs -f zabbixbot
  ```
* –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å Zabbix API:

  ```bash
  curl -k -H 'Content-Type: application/json' \
    -d '{"jsonrpc":"2.0","method":"apiinfo.version","params":[],"id":1}' \
    $ZABBIX_URL
  ```

## üìú –õ–∏—Ü–µ–Ω–∑–∏—è

MIT ¬© 2025 Phystech Team
